define(["jquery","core/ajax","core/notification","mod_lti/tool_type","mod_lti/events","mod_lti/keys"],function(a,b,c,d,e,f){var g={CARTRIDGE_URL:"#cartridge-url",CONSUMER_KEY:"#registration-key",SHARED_SECRET:"#registration-secret",REGISTRATION_FORM:"#cartridge-registration-form",REGISTRATION_SUBMIT_BUTTON:"#cartridge-registration-submit",REGISTRATION_CANCEL_BUTTON:"#cartridge-registration-cancel"},h=function(){return a(g.REGISTRATION_FORM).attr("data-cartridge-url")},i=function(){return a(g.REGISTRATION_SUBMIT_BUTTON)},j=function(){return a(g.REGISTRATION_CANCEL_BUTTON)},k=function(){return a(g.CONSUMER_KEY).val()},l=function(){return a(g.SHARED_SECRET).val()},m=function(){i().addClass("loading")},n=function(){i().removeClass("loading")},o=function(){return i().hasClass("loading")},p=function(){if(!o()){var b=h();if(""!==b){m();var c=k(),f=l(),g=d.create({cartridgeurl:b,key:c,secret:f});return g.done(function(){a(document).trigger(e.NEW_TOOL_TYPE),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION),a(document).trigger(e.REGISTRATION_FEEDBACK,{status:"Success",message:"Successfully created new tool!"})}).always(function(){n()}),g}}},q=function(){var b=i();b.click(function(a){a.preventDefault(),p()}),b.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||(a.keyCode==f.ENTER||a.keyCode==f.SPACE)&&(a.preventDefault(),b.click())});var c=j();c.click(function(b){b.preventDefault(),a(document).trigger(e.STOP_CARTRIDGE_REGISTRATION)}),c.keypress(function(a){a.metaKey||a.shiftKey||a.altKey||a.ctrlKey||(a.keyCode==f.ENTER||a.keyCode==f.SPACE)&&(a.preventDefault(),c.click())})};return{init:function(){q()}}});